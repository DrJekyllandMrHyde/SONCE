checkout:
  post:
    - git submodule sync
    - git submodule update --init --recursive

machine:
  node:
    version: 4.4
  pre:
    - curl https://install.meteor.com | /bin/sh

general:
  branches:
    only:
      - master
      - develop

dependencies:
  override:
    - meteor --version
    - meteor node --version
    - meteor npm --version
    - meteor npm install
    - meteor build --architecture=os.linux.x86_64 --directory ../app --server=http://localhost:3000
    - cd ../app/bundle/programs/server
    - npm install --production
    - cd ../app/bundle
  cache_directories:
    - .meteor

test:
  override:
    - cd ../app/bundle
